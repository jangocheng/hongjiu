<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta charset="utf-8" />
		<title>添加地址</title>
		<link rel="stylesheet" href="<%templateskin%>/css/base.css" />
		<link rel="stylesheet" href="<%templateskin%>/css/style.css" />
		<link rel="stylesheet" href="<%templateskin%>/css/iconfont.css" />
		<link rel="stylesheet" href="<%templateskin%>/css/mui.css" />
		<link rel="stylesheet" href="<%templateskin%>/css/mui.poppicker.css" />
		<link rel="stylesheet" href="<%templateskin%>/css/mui.picker.css" />
		<style type="text/css">
			.mui-toast-container{
				bottom: 30%;
			}
			.mui-switch.mui-active{
				background: #7D0000;
				border-color: #7D0000;
			}
		</style>
	</head>
	<body>
		<div class="mui-content add-address">
		    <div class="mui-input-group">
		  	<form  id="add_addressform">
		  		<div class="mui-input-row">
		            <label>收货人</label>
		            <input type="text" name="txtAcceptName" id="txtName" class="mui-input-clear" placeholder="请输入收件人姓名" datatype="name" errormsg="请正确填写收货人姓名">
		        </div>
		        <div class="mui-input-row">
		            <label>联系电话</label>
		            <input type="text" datatype="phone" errormsg="请填写正确的手机号码" name="txtMobile" id="txtPhone" class="mui-input-clear" placeholder="请输入收件人电话">
		        </div>
		        <div class="mui-input-row">
		            <p class="mui-navigate-right selcity" >所在城市<span  id="cityname">请选择</span></p>
		            <input type="hidden" name="txtProvince" value="" id="sheng" />
		            <input type="hidden" name="txtCity" value="" id="shi" />
		            <input type="hidden" name="txtArea" value="" id='qu' />
		        </div>
		        <div class="mui-input-row mui-hidden">
		        	<input type="hidden" name="txtEmail" id="txtEmail" value="1" />
		        </div>
		        <div class="mui-input-row mui-hidden">
		        	<input type="hidden" name="txtTelphone" id="txtTelphone" value="1" />
		        </div>
		        <div class="mui-input-row mui-hidden">
		        	<input type="hidden" name="txtPostCode" id="txtPostCode" value="1" />
		        </div>
		      
		        <div class="mui-input-row">
		            <label>详细地址</label>
		            <input type="text" id="txtAddress" name="txtAddress" datatype="notnull"   class="mui-input-clear" placeholder="请输入详细地址 具体到门牌号" errormsg="请填写详细地址">
		        </div>
		        <div class="mui-input-row ">
		        		<input type="text" name="txtCode" id="txtCode" placeholder="请输入验证码"/>
		        	 
		        </div>
		        <div class="mui-input-row ">
		        	 <a href="javascript:;" onclick="ToggleCode(this, '{config.webpath}tools/verify_code.ashx');return false;" style="margin-top: 10px;float: left;font-size: 12px;color: #7D0000;margin-left: 12px;"><img src="{config.webpath}tools/verify_code.ashx" width="80" height="22" align="absmiddle" /> 看不清楚？</a>
		        </div>
		    </div>
		    <div class="mui-card">
		    	设为默认
		    	<div class="mui-switch mui-switch-mini mui-active" id="moren">
				  <div class="mui-switch-handle"></div>
				  <input type="hidden" name="is_default" value="1"/>
				</div>
		    </div>
		  	</form>
		    <button id="add_save" type="button" class="mui-btn mui-btn-blue mui-btn-block">保存</button>
		</div>
	</body>
	<script src="<%templateskin%>/js/jquery-1.7.2.min.js"></script>
	<script src="<%templateskin%>/js/mui.min.js"></script>
	<script src="<%templateskin%>/js/common.js"></script>
	<script src="<%templateskin%>/js/mui.picker.js"></script>
	<script src="<%templateskin%>/js/mui.poppicker.js"></script>
	<script src="<%templateskin%>/js/city.js"></script>
	<script>
		mui.init();
		var choo = getQueryString('choose');
		
		
		//城市选择
		var selCity = new mui.PopPicker({
				layer:3
			})
			selCity.setData(cityData);
			mui("body").on("tap",'#cityname',function(){
				//mui.toast(1);
				selCity.show(function(SelectedItem) {
					mui("#cityname")[0].innerHTML = SelectedItem[0].text+" "+SelectedItem[1].text+" "+SelectedItem[2].text;
					mui("input[name=txtProvince]")[0].value = SelectedItem[0].text;
					mui("input[name=txtCity]")[0].value = SelectedItem[1].text;
					mui("input[name=txtArea]")[0].value = SelectedItem[2].text;
				})
		});
		//切换验证码
function ToggleCode(obj, codeurl) {
    $(obj).children("img").eq(0).attr("src", codeurl + "?time=" + Math.random());
	return false;
}
		//用户提交添加地址的相关信息
		mui('body').on('tap','#add_save',function(){
			//var formdata = serialize(document.getElementById('add_addressform'));
			
			var formdata = $('#add_addressform').serialize();
			console.log(formdata);
			if(getValid('add_addressform')){
				mui.ajax('/tools/submit_ajax.ashx?action=user_address_edit',{
					datatype:'string',
					type:'post',
					data:formdata,
					success:function(data){
						data = JSON.parse(data);
							
						if(data.status ==1){
							mui.toast(data.msg);
							if(choo==1){
							//var orderNo ='<%=Qrcms.Common.DTRequest.GetString("order_no")%>'; 
							//var urlObj = window.location.href ;
							var orderNo =  getQueryString('orderNo');
								//alert(orderNo);
								
								setTimeout(function(){
								window.location.href = 'choose_add.aspx?order_no='+orderNo;
							},2000)
							}else{
								setTimeout(function(){
								window.location.href = 'person_zl.aspx';
							},2000)
							}
							
							//alert(1);
						}else{
							mui.toast(data.msg);
							
						}
					},
					error:function(data){
						mui.toast(data.msg);
					}
					
					
				})
			}
		});
	
	
	
	</script>
</html>
