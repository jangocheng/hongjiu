<!DOCTYPE html>
<html>
	<head>
			<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta charset="UTF-8">
		<link rel="stylesheet" href="<%templateskin%>/css/base.css" />		
		<link rel="stylesheet" href="<%templateskin%>/css/mui.min.css" />
		<link rel="stylesheet" href="<%templateskin%>/css/style.css" />
		<title>佣金明细</title>
	</head>
	<body>
		<div class="mui-content mingxi">
			<div class="mui-scroll-wrapper" id="mingxi_wrap">
				<div class="mui-scroll">
					<ul class="mui-table-view" id="mingxi_list">
						<!--<li class="mui-table-view-cell">
							<p class="mui-clearfix">订单消费&nbsp;B201547414<span>-566.00</span></p>
							<p class="mui-clearfix">2017/05/26 12:05</p>
						</li>
						<li class="mui-table-view-cell">
							<p class="mui-clearfix">余额充值&nbsp;B201547414<span>+2000.00</span></p>
							<p class="mui-clearfix">2017/05/26 12:05</p>
						</li>-->
						
					</ul>
				</div>
			</div>
		</div>
		<!--模板引擎绑定数据-->
		
	</body>
	<script src="<%templateskin%>/js/jquery-3.0.0.min.js"></script>
	<script src="<%templateskin%>/js/mui.min.js"></script>
	<script src="<%templateskin%>/js/layer/layer/layer.js"></script>
	<script src="<%templateskin%>/js/layer/laytpl/laytpl.js"></script>
	<script src="<%templateskin%>/js/layer/laypage/laypage.js"></script>
	<script>
		//MUI框架初始化
			mui.init();
		//JS模板引擎
			function LoadTPL(tplid,viewid,data)
				{
				    var tpl = document.getElementById(tplid).innerHTML;
				   
				    var render = laytpl(tpl).render(data);
				 	 $("#"+viewid).append(render);
				   
				 
//				      $('#'+viewid).append(render);
				  
				}
		//页面滚动
			(function($){
			    $(".mui-scroll-wrapper").scroll({
			        //bounce: false,//滚动条是否有弹力默认是true
			        //indicators: false, //是否显示滚动条,默认是true
			    });
    
			})(mui);
			
		//加载明细数据
			function loadsj(page){
				$.ajax({
					url:'/tools/submit_ajax.ashx?action=user_commision_log',
					datatype:"json",
					type:"get",
					data:{page:page,pagesize:10},
					async:false,
					success:function(data){
						 var  data=JSON.parse(data);
        //字符串拼接实现数据渲染
							var html ="";
							
					for(i = 0 ; i<data.Rows.length;i++){
							html += '<li class="mui-table-view-cell"><p class="mui-clearfix">'+'&nbsp;'+data.Rows[i].remark+'&nbsp;'+'<span>'+data.Rows[i].value +'</span></p>';
						html += '<p class="mui-clearfix">' + jsonDateFormat(data.Rows[i].add_time)
 +'</p></li>';
						
							
						
					}
					$('.mui-table-view').append(html);

					/*模板引擎的方式实现数据渲染*/
//						LoadTPL('tbody_template','mingxi_list',data);	
					}
				})
			}
			
			//上拉加载下拉刷新实现更多数据加载
			loadsj(1);
			var page = 1;
			mui.init({
			 	pullRefresh : {
			        container:"#mingxi_wrap",
			        up : {
			            height:150,
			            auto:false,
			            contentrefresh : "正在加载...",
			            contentnomore:'没有更多了',
			            callback :function(data) {
			                var self = this; // 这里的this == mui('#refreshContainer').pullRefresh()
			                // 加载更多的内容
			                if(data.Rows !=""){
			                	 loadMore(this);
			                	 mui('#mingxi_list').pullRefresh().endPullupToRefresh(false);
			                }else{
			                	 mui('#mingxi_list').pullRefresh().endPullupToRefresh(true);
			                }
			               
			            }
			        },
			        down:{
			        	contentrefresh : "正在加载...",
			        	callback:function(){
			        		 var self = this; // 这里的this == mui('#refreshContainer').pullRefresh()
			                // 加载更多的内容
			                loadMore(this);
			        	}
			        } 
			    }
			});
			var loadMore = function(pullRefresh) {
			    // 加载更多的内容到列表中
			 
			    // 如果没有更多数据了，则关闭上拉加载
			    //发起ajax请求，获取json数据，并将它渲染到页面上
			  	page++;
			  	setTimeout(function(){
			  		console.log("第二次加载");
			  		loadsj(page);
			  	},1500)
			  	console.log(1);			   
			};
			
	function jsonDateFormat(jsonDate) { //json时间格式转换
	var date = new Date(parseInt(jsonDate.replace("/Date(", "").replace(")/", ""), 10));
	var month = date.getMonth() + 1 < 10 ? +(date.getMonth() + 1) : date.getMonth() + 1;
	var day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
	var hours = date.getHours();
	var minutes = date.getMinutes();
	var seconds = date.getSeconds();
	var milliseconds = date.getMilliseconds();
	return date.getFullYear() + "-" + getzf(month) + "-" + day + " " + getzf(hours) + ":" + getzf(minutes) + ":" + getzf(seconds) /* + "." + milliseconds*/ ;
};
function getzf(num) { //补0操作
	if(parseInt(num) < 10) {
		num = '0' + num;
	}
	return num;
};
 


		
	</script>
</html>
